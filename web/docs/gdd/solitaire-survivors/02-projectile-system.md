# Projectile System - Foundation 기반 투사체 시스템

## 개요

Solitaire Survivors 모드의 핵심 전투 메카닉은 **Foundation에 카드를 적재하는 것이 직접 투사체를 생성하고 강화**한다는 점이다. 4개의 Suit는 각각 고유한 투사체 타입에 매핑되며, Foundation에 쌓인 카드의 높이와 Rank가 투사체의 수량과 위력을 결정한다.

이 설계는 솔리테어 플레이와 전투가 **실시간으로 긴밀히 연결**되어야 한다는 요구사항에서 출발했다. 플레이어는 Foundation에 카드를 올릴 때마다 즉각적인 전투 보상(투사체 발사)을 받으며, 어떤 Suit를 우선 쌓을지에 따라 전투 스타일이 달라진다.

---

## Suit → 투사체 타입 매핑

4개의 Suit가 4개의 투사체 타입에 1:1 대응된다. 각 투사체는 고유한 공격 패턴과 전술적 역할을 가진다.

| Suit | 투사체 타입 | 기본 행동 | 전술적 역할 | 색상 테마 |
|------|-----------|----------|-----------|---------|
| **Spade** (스페이드) | Slash (검기) | 플레이어 전방 부채꼴 근접 공격, 넉백 효과 | 근접 방어, 군중 제어 | 검정/보라 |
| **Heart** (하트) | Holy Orb (성탄 오브) | 플레이어 주변을 공전하며 접촉 시 피해 | 패시브 방어, 근거리 지속 피해 | 빨강/분홍 |
| **Diamond** (다이아몬드) | Arrow (화살) | 가장 가까운 적을 향해 직선 발사, 유도 기능 | 원거리 단일 타겟 처치 | 파랑/하늘 |
| **Club** (클럽) | Fireball (화염구) | 랜덤 방향으로 발사, 착탄 시 범위 피해 | 광역 대미지, 몰려오는 적군 처리 | 초록/주황 |

### 설계 의도

- **Spade (검기)**: 근접 공격 + 넉백으로 "최후의 방어선" 역할. 적이 가까이 왔을 때의 위기 대응.
- **Heart (오브)**: 공전 패턴으로 플레이어가 신경 쓰지 않아도 자동 방어. 솔리테어에 집중할 여유 제공.
- **Diamond (화살)**: 명확한 단일 타겟 킬러. 위협적인 개별 적(보스, 엘리트) 처리에 최적.
- **Club (화염구)**: 랜덤성과 범위로 "카오스" 담당. 적 웨이브가 몰려올 때 화력 지원.

---

## 투사체 수량 계산

각 Suit의 투사체 개수는 **해당 Foundation 파일의 최고 Rank**에 의해 결정된다.

### 공식

```
투사체 수 = ceil(해당 Suit Foundation 최고 Rank / 3)
최소: 1개 (Foundation에 A만 있을 때)
최대: 5개 (Foundation에 K가 있을 때, 13 / 3 = 4.33... → 5)
```

### Rank별 투사체 수 테이블

| Foundation 최고 Rank | 투사체 개수 |
|---------------------|-----------|
| A (1) | 1개 |
| 2 | 1개 |
| 3 | 1개 |
| 4 | 2개 |
| 5 | 2개 |
| 6 | 2개 |
| 7 | 3개 |
| 8 | 3개 |
| 9 | 3개 |
| 10 | 4개 |
| J (11) | 4개 |
| Q (12) | 4개 |
| **K (13)** | **5개 + 특수 강화** |

### 설계 의도

- **점진적 강화**: A부터 K까지 순차적으로 쌓으면서 자연스럽게 화력이 증가.
- **3단 구간**: 1개 → 2개 → 3개 → 4개 → 5개로 명확한 단계 구분.
- **K 완성 보상**: 최종 5개 + 특수 효과로 "Full Suit 달성"의 만족감 극대화.

---

## 투사체 기본 스탯

각 투사체 타입의 기본 성능 수치는 다음과 같다.

| Suit | 투사체 | 기본 데미지 | 발사 간격(초) | 사거리 | 특수 효과 |
|------|--------|----------|-------------|--------|---------|
| Spade | Slash (검기) | 20 | 0.8 | 짧음 (부채꼴 근접) | 넉백 |
| Heart | Holy Orb (성탄 오브) | 8 | 공전 상시 | 중간 (오브 공전 반경) | 접촉 지속 피해 |
| Diamond | Arrow (화살) | 15 | 1.0 | 길음 (화면 끝까지) | 유도 |
| Club | Fireball (화염구) | 25 | 1.5 | 중간 | 착탄 시 범위 피해 |

### 밸런스 의도

- **Spade (검기)**: 높은 DPS (25 dps) + 넉백으로 근접 방어 특화. 단, 사거리 짧음.
- **Heart (오브)**: 낮은 데미지 (8) 상시 공격으로 "패시브 딜러". 5개 오브 시 40 dps로 준수.
- **Diamond (화살)**: 중간 데미지 (15 dps) + 유도로 안정적 단일 타겟. 보스킬에 최적.
- **Club (화염구)**: 가장 높은 데미지 (25) + 범위, 단 긴 쿨타임 (1.5초)과 랜덤 방향으로 트레이드오프.

---

## 데미지 스케일링

투사체의 최종 데미지는 **두 가지 요소**의 곱셈으로 결정된다.

### 1. 콤보 타이머 (주된 스케일링)

**콤보 시스템**: Foundation에 카드를 올린 시점부터 **10초 카운트 시작**. 10초 내에 같은 Suit에 추가 카드를 올리면 콤보가 증가하고 타이머가 리셋된다.

| 콤보 카운트 | 데미지 배율 |
|-----------|----------|
| 1콤보 | x1.0 (기본) |
| 2콤보 | x1.3 |
| 3콤보 | x1.6 |
| 4콤보 이상 | x2.0 (상한) |

**적용 방식**:
- 콤보 배율은 **해당 적재 시 발생하는 즉발 투사체**에만 적용된다.
- 10초가 지나면 콤보가 리셋되고, 다음 적재는 다시 1콤보(x1.0)부터 시작.

**예시**:
1. Spade A 적재 → 1콤보 (x1.0) → 검기 1발 발사 (데미지 20)
2. 5초 후 Spade 2 적재 → 2콤보 (x1.3) → 검기 1발 발사 (데미지 26)
3. 3초 후 Spade 3 적재 → 3콤보 (x1.6) → 검기 1발 발사 (데미지 32)
4. 12초 대기 (타이머 만료) → 콤보 리셋
5. Spade 4 적재 → 1콤보 (x1.0) → 검기 2발 발사 (데미지 20 × 2)

### 2. Rank 보너스 (보조 스케일링)

Foundation에 올린 카드의 Rank가 높을수록 추가 보너스 배율이 적용된다.

| Rank 범위 | 배율 |
|----------|------|
| A ~ 9 | x1.0 (보너스 없음) |
| 10 ~ K | x1.3 |

**적용 방식**:
- Rank 배율은 콤보 배율과 **곱셈**으로 적용된다.
- 예: 3콤보(x1.6) + K 카드(x1.3) = x2.08

**설계 의도**:
- **콤보 타이머**: 플레이어의 **실력 기반 보상**. "빠르고 정확한 연속 적재"를 유도.
- **Rank 보너스**: 높은 카드 적재의 **보상감**. K 완성에 가까워질수록 더 강한 즉발 투사체.
- 두 요소를 분리함으로써 "빠른 연속 적재"와 "높은 카드 적재"라는 두 가지 숙련 축 제공.

---

## K 완성 시 특수 강화 (Full Suit Bonus)

한 Suit의 Foundation이 K까지 완성되면 해당 투사체가 **영구적으로 특수 효과**를 획득한다.

| Suit | K 완성 특수 효과 | 설명 | 영구 여부 |
|------|---------------|------|---------|
| **Spade** | **관통 검기** | 검기가 적을 관통하여 뒤쪽 적도 타격 | O |
| **Heart** | **폭발 오브** | 공전 궤도 반경 1.5배 확대 + 접촉 시 범위 폭발 발생 | O |
| **Diamond** | **관통 화살** | 화살이 일직선으로 모든 적 관통 + 유도 성능 강화 | O |
| **Club** | **대형 화염구** | 범위 2배 증가 + 착탄 지점에 3초 화염 장판 생성 | O |

### 설계 의도

- **"Full Suit 달성"의 보상**: Klondike에서 A~K를 순서대로 완성하는 것은 쉽지 않다. 달성 시 명확한 강화로 성취감 제공.
- **영구 효과**: 한 번 획득하면 게임 종료까지 유지. 후반부 화력 증가 곡선의 핵심 축.
- **시각적 변화**: 투사체 외형과 이펙트가 변화하여 플레이어에게 즉각적 피드백.

---

## 크로스 Suit 듀얼 콤보

**2개 이상의 Suit가 특정 조건을 만족**하면 융합 투사체가 자동 발사된다. 색상 기반으로 직관적인 3가지 조합.

### 조합 테이블

| 콤보명 | 조건 | 발동 효과 | 영구 여부 |
|--------|------|----------|---------|
| **Red 콤보** (성스러운 화살비) | Heart + Diamond 모두 **Tier 3** (7장 이상) | 10초마다 범위 내 아군 회복 + 유도 혼합탄 자동 발사 | O (조건 충족 시) |
| **Black 콤보** (암흑 폭풍) | Spade + Club 모두 **Tier 3** (7장 이상) | 10초마다 관통 + 폭발 혼합탄 자동 발사 | O (조건 충족 시) |
| **Royal 콤보** (로얄 오라) | **4 Suit 모두 Tier 3** (7장 이상) | 캐릭터 주변 상시 데미지 필드 (Vampire Survivors 성경 유사) | O (조건 충족 시) |

### Tier 기준

| Foundation 최고 Rank | Tier |
|---------------------|------|
| A ~ 3 | Tier 1 |
| 4 ~ 6 | Tier 2 |
| 7 ~ 9 | Tier 3 |
| 10 ~ Q | Tier 4 |
| K (13) | Tier 5 (Full Suit) |

듀얼 콤보는 **Tier 3 (7장)** 기준이므로, 게임 중반부터 해금 가능하다.

### 설계 의도

- **색상 직관성**: Red (Heart+Diamond), Black (Spade+Club), Royal (4 Suit)로 외우기 쉬움.
- **밸런싱 가능성**: 3가지 조합만 관리하면 되므로 조율 부담 낮음.
- **중기 목표**: Tier 3 조건으로 게임 중반(7~10분) 해금. 후반부 화력 증가 곡선의 중간 마일스톤.
- **시각적 강화**: 콤보 해금 시 캐릭터 주변 이펙트(Red: 빨강 입자, Black: 검정 번개, Royal: 무지개 오라)로 보상감 극대화.

---

## Foundation 적재 즉시 효과 (Instant Feedback)

카드를 Foundation에 올리는 **그 순간**에 다음 효과가 발생한다.

### 즉시 효과 순서

1. **투사체 수 재계산 및 적용**: 해당 Suit 투사체 개수 즉시 업데이트.
2. **즉발 투사체 발사**: 해당 Suit 투사체 1발을 **콤보 배율 + Rank 배율 적용**하여 즉시 발사.
3. **시각 이펙트**: 화면에 Suit 색상의 파티클 폭발 이펙트.
4. **전역 넉백**: 화면 내 모든 적을 0.3초간 넉백 (짧은 무적 시간 제공).

### 예시 시나리오

**상황**: Spade Foundation이 6까지 쌓여있고(투사체 2개), 2콤보 상태에서 Spade 7을 적재.

1. 투사체 수: 2개 → 3개로 증가 (7 / 3 = 2.33... → 3)
2. 즉발 투사체: 검기 1발 발사 (데미지 20 × 2콤보(x1.3) = 26)
3. 보라색 파티클 폭발
4. 모든 적 0.3초 넉백

### 설계 의도

- **즉각적 보상**: 솔리테어 플레이가 전투에 미치는 영향을 **시각·청각·게임플레이** 모든 축에서 즉시 피드백.
- **위기 대응 메카닉**: 적이 몰려올 때 Foundation 적재로 **즉시 공간 확보** 가능. 단순한 강화가 아닌 전술적 타이밍 요소.
- **리듬감**: 0.3초 넉백으로 플레이어가 "한 박자 쉴 수 있는" 순간 제공. 멀티태스킹 부담 완화.

---

## 투사체 시스템의 전략적 깊이

### 초반 전략 (0~3분)

- 4개 Suit에 골고루 A 적재 → 4가지 투사체 1개씩 확보.
- 상황에 따라 한 Suit 집중 (예: 적이 빠르게 몰려오면 Diamond 우선 → 화살로 원거리 저격).

### 중반 전략 (3~7분)

- Tier 3 (7장) 도달을 목표로 2개 Suit 집중.
- Red 콤보 or Black 콤보 해금으로 화력 급증.
- 콤보 타이머 유지를 위해 빠른 적재 연습.

### 후반 전략 (7~10분)

- K 완성으로 특수 효과 획득.
- Royal 콤보 해금 (4 Suit 모두 Tier 3) → 상시 데미지 필드로 방어 자동화.
- 투사체 수 최대치(5개 × 4 Suit = 20개 투사체) 달성 시 화면 전체 화력 포화.

### 숙련 요소

1. **콤보 타이머 관리**: 10초 내 연속 적재를 위한 빠른 판단 + 정확한 드래그.
2. **Suit 우선순위**: 현재 웨이브의 적 약점에 맞춰 어떤 Suit를 먼저 쌓을지 선택.
3. **즉발 투사체 타이밍**: 적 웨이브 직전에 고의로 적재를 지연했다가 "한 방에" 여러 장 적재로 즉발 연타.

---

## 구현 우선순위

### Phase 1 (MVP)

1. 4가지 투사체 타입 기본 구현 (Slash, Holy Orb, Arrow, Fireball)
2. 투사체 수 공식 (`ceil(Rank / 3)`)
3. Foundation 적재 → 즉발 투사체 발사
4. 기본 데미지 + 발사 간격

### Phase 2 (스케일링)

1. 콤보 타이머 시스템 (10초, 1~4콤보)
2. Rank 보너스 (10~K x1.3)
3. 즉시 효과 (파티클 + 전역 넉백)

### Phase 3 (특수 효과)

1. K 완성 특수 효과 4종
2. 듀얼 콤보 3종 (Red/Black/Royal)

---

## 기존 Defense 모드와의 차이점

| 항목 | Defense 모드 | Survivors 모드 |
|------|------------|--------------|
| 전투 방식 | 턴제 (Card Phase → Battle Phase) | 실시간 동시 진행 |
| 강화 방식 | 유닛 소환 + 배치 | 투사체 자동 강화 |
| Foundation 역할 | 유닛 클래스/등급 결정 | 투사체 타입/수량/위력 결정 |
| Rank 의미 | 유닛 Grade (Bronze/Silver/Gold) | 투사체 수 증가 + 보너스 배율 |
| Suit 콤보 | 연속 적재 보너스 (ATK/HP) | 콤보 타이머 배율 + 듀얼 콤보 |
| Full Suit | 챔피언 유닛 소환 | 투사체 특수 효과 영구 해금 |
| 플레이어 조작 | 유닛 배치 위치 선택 | 자동 공격, 솔리테어에 집중 |

가장 큰 차이는 Defense가 "유닛 소환 + 배치 전략"인 반면, Survivors는 "자동 공격 + Foundation 강화 전략"이라는 점이다. 플레이어는 솔리테어 플레이에 더 집중하고, 투사체는 백그라운드에서 자동으로 작동한다.

---

## 참고: 논의 과정 요약

이 투사체 시스템은 3라운드 토론(`06-debate-log.md` 참조)을 거쳐 최종 합의되었다.

- **Classic Rule Agent 제안**: Suit → 투사체 매핑, 수 공식(`ceil`), K 특수효과, Rank 구간 배율.
- **Creative Rule Agent 제안**: 콤보 타이머, 크로스 Suit 콤보, 양방향 피드백, 즉시 효과.
- **Orchestrator 판정**: Classic의 명확한 매핑/공식 위에 Creative의 콤보 타이머와 듀얼 콤보(3종)를 레이어링. Rank 구간 배율은 "선택이 아닌 자동 진행"이라는 Creative 비판을 수용하여 콤보 타이머(주) + Rank 보너스(부)로 조정.

불채택된 요소:
- **6+ 크로스 Suit 조합**: 밸런싱 변수 폭발 → 3종(Red/Black/Royal)으로 축소.
- **Rank 구간 고정 배율**: 플레이어 선택이 아님 → 콤보 타이머로 대체.
