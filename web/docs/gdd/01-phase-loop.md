# 페이즈 구조와 게임 흐름

## 개요

Solitary는 **솔리테어 페이즈**와 **디펜스 페이즈**를 번갈아 진행하는 턴제 구조입니다. 플레이어는 솔리테어를 풀어 유닛을 소환하고, 디펜스 페이즈에서 몬스터 웨이브를 방어합니다. Core HP가 0이 되거나 목표 웨이브를 클리어하면 게임이 종료됩니다.

## 게임 플로우차트

```
게임 시작
    ↓
┌─────────────────────────────────────┐
│ 솔리테어 페이즈 (플레이어 템포)      │
│ - 카드 플레이 (무제한 시간)          │
│ - Foundation 진행 → Energy +1       │
│ - Tableau 카드 뒤집기 → Spell +1    │
│ - "준비 완료" 버튼 클릭              │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 디펜스 페이즈 (자동 진행, 10-15초)   │
│ - 유닛 vs 몬스터 자동 전투           │
│ - Spell 토큰으로 전술 개입 가능      │
│ - 몬스터 돌파 시 Core HP -1         │
└─────────────────────────────────────┘
    ↓
┌─────────────────────────────────────┐
│ 결과 처리                            │
│ - 스코어 계산                        │
│ - Core HP 체크                      │
└─────────────────────────────────────┘
    ↓
    ├─ Core HP > 0 → 다음 웨이브 (솔리테어 페이즈로)
    └─ Core HP = 0 또는 목표 웨이브 클리어 → 게임 종료
```

## 페이즈 상세

### 1. 솔리테어 페이즈

**목적**: 카드 플레이를 통해 유닛 소환 자원을 확보하고 다음 디펜스를 준비합니다.

**특징**:
- 시간 제한 없음 (플레이어가 템포 조절)
- 표준 클론다이크 규칙 적용
- 턴제이므로 Undo 기능 없음 (사고 시간이 충분하며, Recall Spell이 안전장치 역할)

**게임 보드 구성**:
- **Tableau**: 7열, 각 열에 1~7장 배치 (맨 위 카드만 공개)
- **Stock/Waste**: Stock에서 3장씩 턴, 무제한 재순환 (패널티 없음)
- **Foundation**: 4개 (♠♥♣♦), A부터 K까지 순차 쌓기

**자원 획득 메카닉**:
- **Energy +1**: Foundation에 카드를 올릴 때마다 획득
- **Spell 토큰 +1**: Tableau에서 뒷면 카드를 뒤집을 때마다 획득

**페이즈 전환**:
- 플레이어가 "준비 완료" 버튼을 클릭하면 디펜스 페이즈로 전환
- 현재 게임 상태는 유지되며, 다음 솔리테어 페이즈에서 이어서 플레이

### 2. 디펜스 페이즈

**목적**: 소환된 유닛으로 몬스터 웨이브를 방어하고 Core를 보호합니다.

**특징**:
- 자동 진행 (10~15초 소요)
- 유닛과 몬스터의 전투는 자동 해결
- 플레이어는 Spell 토큰을 사용하여 전술적 개입 가능

**전투 흐름**:
1. 웨이브 시작 시 몬스터들이 Foundation 영역을 향해 진격
2. Foundation에 배치된 유닛이 자동으로 몬스터와 교전
3. 유닛 강도는 해당 Foundation의 진행도(쌓인 카드 수)에 비례
4. 몬스터 격파 실패 시 Foundation 영역 도달 → **Core HP -1**

**Spell 토큰 사용**:
- 디펜스 중 실시간으로 Spell 사용 가능
- 예시: 유닛 강화, 몬스터 둔화, 긴급 힐 등
- Spell 토큰은 솔리테어 페이즈에서 획득한 만큼만 사용 가능

**웨이브 종료 조건**:
- 모든 몬스터 격파 → 웨이브 클리어
- Core HP = 0 → 게임 오버

### 3. 결과 처리

**스코어 계산**:
- Foundation 진행도 점수
- 남은 Core HP 보너스
- 웨이브 클리어 보너스

**다음 단계 분기**:
- **Core HP > 0**: 다음 웨이브 진행 (솔리테어 페이즈로 복귀)
- **Core HP = 0**: 게임 오버
- **목표 웨이브 클리어** (캠페인 모드): 승리

## 연결 메카닉

### 정방향 연결 (솔리테어 → 디펜스)
- **Foundation 진행도 → 유닛 강도**: Foundation에 쌓인 카드가 많을수록 해당 슈트의 유닛이 강력해짐
- **Spell 토큰 획득**: Tableau 카드 뒤집기로 디펜스 중 사용할 전술 자원 확보

### 역방향 압박 (디펜스 → 솔리테어)
- **Core HP 감소**: 디펜스 실패 시 Core HP가 줄어들어 시간 압박 증가
- 3번의 실패 기회만 있으므로 솔리테어를 효율적으로 풀어야 함

### 양방향 상호작용
- **Energy**: Foundation 진행으로 획득, 유닛 소환/강화에 사용
- **Spell 토큰**: 솔리테어에서 획득, 디펜스에서 소비

## 게임 모드별 플레이 타임

### 캠페인 모드 (10웨이브)
- 예상 플레이 시간: **10~15분**
- 웨이브당 평균 1~1.5분 (솔리테어 + 디펜스)

### 무한 모드
- 시간 제한 없음
- 웨이브 난이도 점진적 증가
- Core HP 0 될 때까지 진행

## 디자인 의도

### 턴제 구조 채택 이유
1. **사고 시간 보장**: 솔리테어 페이즈에서 충분히 생각하고 플레이 가능
2. **전략적 깊이**: 언제 디펜스로 넘어갈지 타이밍 선택
3. **Undo 불필요**: 실수해도 다음 턴에 대응 가능, 긴장감 유지
4. **안전장치**: Recall Spell이 치명적 실수 복구용으로 존재

### 페이즈 분리의 장점
- 솔리테어 퍼즐 풀이와 타워 디펜스 전투를 명확히 구분
- 각 페이즈에서 요구하는 스킬셋이 다름 (논리적 사고 vs 전술적 판단)
- 짧은 사이클(1~1.5분)로 지루함 방지
